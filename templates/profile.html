<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - AI Trading Expert Advisor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="gradient-bg text-white py-6 px-4">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i data-lucide="brain" class="w-8 h-8"></i>
                    <h1 class="text-3xl font-bold">AI Trading Expert Advisor</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="{{ url_for('index') }}" class="text-blue-100 hover:text-white">Dashboard</a>
                    <a href="{{ url_for('logout') }}" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
            <h2 class="text-xl font-semibold mb-6 flex items-center">
                <i data-lucide="user" class="w-5 h-5 mr-2 text-blue-600"></i>
                User Profile
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <div class="px-3 py-2 bg-gray-50 rounded-lg">{{ current_user.username }}</div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <div class="px-3 py-2 bg-gray-50 rounded-lg">{{ current_user.email }}</div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Member Since</label>
                        <div class="px-3 py-2 bg-gray-50 rounded-lg">{{ current_user.created_at.strftime('%B %d, %Y') }}</div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Account Type</label>
                        <div class="px-3 py-2 bg-gray-50 rounded-lg">
                            {% if current_user.is_admin %}
                                Administrator
                            {% else %}
                                Trader
                            {% endif %}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <div class="px-3 py-2 bg-green-50 text-green-700 rounded-lg">Active</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Signals Filter -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-8 card-hover">
            <h2 class="text-xl font-semibold mb-6 flex items-center">
                <i data-lucide="filter" class="w-5 h-5 mr-2 text-green-600"></i>
                My Trading Signals
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Symbol</label>
                    <select id="filterSymbol" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">All Symbols</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Signal Type</label>
                    <select id="filterSignalType" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">All Types</option>
                        <option value="LONG">Long</option>
                        <option value="SHORT">Short</option>
                        <option value="NEUTRAL">Neutral</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Confidence</label>
                    <select id="filterConfidence" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">All Levels</option>
                        <option value="HIGH">High</option>
                        <option value="MEDIUM">Medium</option>
                        <option value="LOW">Low</option>
                    </select>
                </div>

                <div class="flex items-end">
                    <button id="applyFilters" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                        Apply Filters
                    </button>
                </div>
            </div>

            <div id="userSignals" class="space-y-4">
                <div class="text-center py-8">
                    <i data-lucide="search" class="w-12 h-12 mx-auto text-gray-300 mb-4"></i>
                    <p class="text-gray-500">Click "Apply Filters" to load your signals</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // Load symbols for filter
        async function loadSymbols() {
            try {
                const response = await fetch('/get_symbols');
                const data = await response.json();

                if (response.ok && data.symbols) {
                    const symbolSelect = document.getElementById('filterSymbol');
                    data.symbols.forEach(symbol => {
                        const option = document.createElement('option');
                        option.value = symbol.name;
                        option.textContent = symbol.name;
                        symbolSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading symbols:', error);
            }
        }

        // Apply filters and load signals
        document.getElementById('applyFilters').addEventListener('click', async function() {
            const symbol = document.getElementById('filterSymbol').value;
            const signalType = document.getElementById('filterSignalType').value;
            const confidence = document.getElementById('filterConfidence').value;

            const params = new URLSearchParams();
            if (symbol) params.append('symbol', symbol);
            if (signalType) params.append('signal_type', signalType);
            if (confidence) params.append('confidence', confidence);

            try {
                const response = await fetch(`/get_user_signals?${params}`);
                const data = await response.json();

                if (response.ok) {
                    displaySignals(data.signals);
                } else {
                    document.getElementById('userSignals').innerHTML = '<p class="text-red-600">Error loading signals</p>';
                }
            } catch (error) {
                document.getElementById('userSignals').innerHTML = '<p class="text-red-600">Error loading signals</p>';
            }
        });

        function displaySignals(signals) {
            const container = document.getElementById('userSignals');

            if (signals.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i data-lucide="inbox" class="w-12 h-12 mx-auto text-gray-300 mb-4"></i>
                        <p class="text-gray-500">No signals found matching your filters</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = signals.map(signal => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-semibold">${signal.symbol} Signal</h3>
                        <span class="px-2 py-1 rounded-full text-sm font-medium ${
                            signal.signal_type === 'LONG' ? 'bg-green-100 text-green-800' :
                            signal.signal_type === 'SHORT' ? 'bg-red-100 text-red-800' :
                            'bg-gray-100 text-gray-800'
                        }">${signal.signal_type}</span>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">Entry Price:</span>
                            <span class="font-mono">${signal.entry_price.toFixed(5)}</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Position Size:</span>
                            <span class="font-mono">${signal.position_size.toFixed(2)} lots</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Confidence:</span>
                            <span class="font-medium">${signal.confidence}</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Date:</span>
                            <span>${new Date(signal.timestamp).toLocaleDateString()}</span>
                        </div>
                    </div>

                    <div class="mt-3">
                        <span class="text-gray-600 text-sm">Reasoning:</span>
                        <p class="text-sm text-gray-700 mt-1">${signal.reasoning}</p>
                    </div>
                </div>
            `).join('');

            lucide.createIcons();
        }

        // Load symbols on page load
        loadSymbols();
    </script>
</body>
</html>